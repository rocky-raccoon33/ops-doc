
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>02 索引 - ops docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ops docs" class="md-header__button md-logo" aria-label="ops docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ops docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              02 索引
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ops docs" class="md-nav__button md-logo" aria-label="ops docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ops docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        仅供ops内部交流
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Oceanbase
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Oceanbase" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Oceanbase
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          1 介绍
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="1 介绍" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          1 介绍
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1%20%E4%BB%8B%E7%BB%8D/01%20%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        01 概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1%20%E4%BB%8B%E7%BB%8D/02%20Mysql%E5%85%BC%E5%AE%B9%E6%80%A7%E5%AF%B9%E6%AF%94/" class="md-nav__link">
        02 Mysql兼容性对比
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          2 架构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2 架构" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          2 架构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2%20%E6%9E%B6%E6%9E%84/01%20%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        01 整体架构
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          3 多租户 索引 分区
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="3 多租户 索引 分区" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          3 多租户 索引 分区
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01%20%E5%A4%9A%E7%A7%9F%E6%88%B7/" class="md-nav__link">
        01 多租户
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          02 索引
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        02 索引
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    索引简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    设计原则
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btree-hash" class="md-nav__link">
    BTREE 索引与 HASH 索引
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oceanbase" class="md-nav__link">
    局部索引和全局索引 OCEANBASE
  </a>
  
    <nav class="md-nav" aria-label="局部索引和全局索引 OCEANBASE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    局部索引 LOCAL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global" class="md-nav__link">
    全局索引 GLOBAL
  </a>
  
    <nav class="md-nav" aria-label="全局索引 GLOBAL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-non-partitioned-index" class="md-nav__link">
    全局非分区索引（Global Non-Partitioned Index）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-partitioned-index" class="md-nav__link">
    全局分区索引（Global Partitioned Index）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    唯一索引和非唯一索引
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    索引的使用
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    索引的存储
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03%20MySql%E5%88%86%E5%8C%BA/" class="md-nav__link">
        03 MySql分区
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04%20QA/" class="md-nav__link">
        04 QA
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          4 数据库对象
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="4 数据库对象" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          4 数据库对象
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1/01%20%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        01 分布式数据库对象
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          5 事务管理
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="5 事务管理" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          5 事务管理
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5%20%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/01%20%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/" class="md-nav__link">
        01 事务管理
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6">
          6 迁移问题
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="6 迁移问题" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          6 迁移问题
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6%20%E8%BF%81%E7%A7%BB%E9%97%AE%E9%A2%98/01%20%E8%BF%81%E7%A7%BB/" class="md-nav__link">
        01 迁移
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Prometheus
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prometheus" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Prometheus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../prometheus/00%20promethues/" class="md-nav__link">
        00 promethues
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    索引简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    设计原则
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btree-hash" class="md-nav__link">
    BTREE 索引与 HASH 索引
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oceanbase" class="md-nav__link">
    局部索引和全局索引 OCEANBASE
  </a>
  
    <nav class="md-nav" aria-label="局部索引和全局索引 OCEANBASE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    局部索引 LOCAL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global" class="md-nav__link">
    全局索引 GLOBAL
  </a>
  
    <nav class="md-nav" aria-label="全局索引 GLOBAL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-non-partitioned-index" class="md-nav__link">
    全局非分区索引（Global Non-Partitioned Index）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-partitioned-index" class="md-nav__link">
    全局分区索引（Global Partitioned Index）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    唯一索引和非唯一索引
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    索引的使用
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    索引的存储
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>02 索引</h1>

<h2 id="_1">索引简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>根据自身业务的需求来决定在某些字段创建索引，从而加快在这些字段的查询速度</p>
<p><strong><code>使用索引</code>:</strong></p>
<ul>
<li>加速查询</li>
<li>索引存储的列数通常较少，可以节省查询 IO</li>
</ul>
<p><strong><code>but:</code></strong></p>
<ul>
<li>当<code>业务发生变化</code>时，需要重新评估以前创建的索引是否满足需求。</li>
<li>写入数据时，需要<code>维护索引表</code>中的数据，消耗一定的性能代价。</li>
<li>索引表会占用<code>内存、磁盘</code>等资源。</li>
</ul>
<hr />
<h2 id="_2">设计原则<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<ul>
<li>最适合索引的列是出现在 <code>WHERE 子句</code>中的列，或连接子句中指定的列。</li>
<li>使用<code>惟一索引</code>。考虑某列中值的分布。索引的列的基数越大，索引的效果越好。</li>
<li>使用短索引。如果对字符串列进行索引，应该指定一个前缀长度，只要有可能就应该这样做。</li>
<li>利用最左前缀。 在创建一个 n 列的索引时， 实际是创建了 MySQL 可利用的 n 个索引。多列索引可起几个索引的作用， 因为可利用索引中最左边的列集来匹配行。 这样的列集称为最左前缀。</li>
<li>不要过度索引。每个额外的索引都要占用额外的磁盘空间， 并降低写操作的性能。 在修改表的内容时， 索引必须进行更新，有时可能需要重构，因此，索引越多，所花的时间越长。</li>
<li>对于 InnoDB 存储引擎的表，尽量自己指定主键。InnoDB 表的普通索引都会保存主键的键值，所以主键要尽可能选择较短的数据类型， 可以有效地减少索引的磁盘占用， 提高索引的缓存效果。</li>
</ul>
<hr />
<h2 id="btree-hash">BTREE 索引与 HASH 索引<a class="headerlink" href="#btree-hash" title="Permanent link">&para;</a></h2>
<p>MEMORY 存储引擎的表可以选择使用 <code>BTREE索引</code>或者 <code>HASH索引</code>， 两种不同类型的索引各有其不同的适用范围。</p>
<p><code>HASH</code> 索引有一些重要的特征需要在使用的时候特别注意：</p>
<ul>
<li>只用于使用=或&lt;=&gt;（NULL的安全比较）操作符的等式比较（但是很快）。</li>
<li>优化器不能使用 HASH 索引来加速 ORDER BY 操作。</li>
<li>MySQL 不能确定在两个值之间大约有多少行。 如果将一个 MyISAM 表改为 HASH 索
    引的 MEMORY 表，会影响一些查询的执行效率。</li>
<li>只能使用整个关键字来搜索一行。</li>
</ul>
<p>而对于 <code>BTREE</code> 索引， 当使用&gt;、 &lt;、 &gt;=、 &lt;=、 BETWEEN、!=或者&lt;&gt;， 或者 LIKE 'pattern' （其
中'pattern'不以通配符开始）操作符时，都可以使用相关列上的索引。</p>
<p><code>IN</code>范围查询适用于 BTREE 索引和 HASH 索引：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">key_col</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p><strong>InnoDB 和 MyISAM 不支持HASH索引类型</strong>，如果指定了使用HASH类型的索引，会被替换为BTREE。</p>
<p><strong>注意</strong>：如果需要访问大部分行，顺序读取要快得多，因为此时应避免磁盘搜索。</p>
<hr />
<h2 id="oceanbase">局部索引和全局索引 <code>OCEANBASE</code><a class="headerlink" href="#oceanbase" title="Permanent link">&para;</a></h2>
<p>MySQL/PostgreSQL 只实现了<code>本地索引</code>
ORACLE 有 <code>本地索引</code> <code>全局索引</code></p>
<h3 id="local">局部索引 <code>LOCAL</code><a class="headerlink" href="#local" title="Permanent link">&para;</a></h3>
<p>局部索引是针对<code>单个分区上</code>的数据创建的索引，因此局部索引的索引键值跟表中的数据是一一对应的关系，即<code>局部索引上的一个分区一定对应到一个表分区</code>，它们具有相同的分区规则，因此对于<code>局部唯一索引</code>而言，它只能保证分区<code>内部的唯一性</code>，而无法保证表数据的全局唯一性。<strong>如果要使用局部唯一索引去对数据唯一性做约束，那么局部唯一索引中必须包含表分区键</strong></p>
<p><img alt="" src="../img/local_index.jpeg" />
<code>employee</code> 表按照 <code>emp_id</code> 做了 Range 分区，同时也在 <code>emp_name</code> 上创建了局部索引。</p>
<h3 id="global">全局索引 <code>GLOBAL</code><a class="headerlink" href="#global" title="Permanent link">&para;</a></h3>
<p>全局索引的分区规则跟表分区是相互独立的，全局索引允许指定自己的分区规则和分区个数，<code>不一定需要跟表分区规则保持一致</code></p>
<h4 id="global-non-partitioned-index">全局非分区索引（Global Non-Partitioned Index）<a class="headerlink" href="#global-non-partitioned-index" title="Permanent link">&para;</a></h4>
<p><code>不分区</code>：保持单一的数据结构，和非分区表的索引类似。但由于主表已经做了分区，因此会出现索引中的某一个键映射到不同主表分区的情况，即一对多的对应关系</p>
<p><img alt="" src="../img/p356070.jpeg" /></p>
<h4 id="global-partitioned-index">全局分区索引（Global Partitioned Index）<a class="headerlink" href="#global-partitioned-index" title="Permanent link">&para;</a></h4>
<p><code>分区</code>：索引数据按照指定的方式做分区处理，将索引数据分散到不同的分区中。但索引的分区模式是完全独立的，和主表的分区没有任何关系，因此对于每个索引分区来说，里面的某一个键都可能映射到不同的主表分区（当索引键有重复值时），索引分区和主表分区之间是多对多的对应关系。</p>
<p><img alt="" src="../img/p355603.jpeg" /></p>
<p><code>employee</code> 表按照 <code>emp_id</code> 做了 <code>Range</code> 分区，同时在 <code>emp_name</code> 上做了全局分区索引。可以看到同一个索引分区里的键，会指向不同的主表分区。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>非分区表也可以创建全局分区索引，但如果主表没有分区，通常来说索引也就没有必要分区了。</p>
<p>推荐使用<code>全局索引</code>的场景包括：</p>
<ul>
<li>
<p>业务上除了主键外，还有其他列的组合需要满足全局唯一性的强需求，这个业务需求仅能通过全局性的唯一索引来实现</p>
</li>
<li>
<p>业务的查询无法得到分区键的条件谓词，且业务表没有高并发的同时写入，为避免进行全分区的扫描，可以根据查询条件构建全局索引，必要时可以将全局索引按照新的分区键来分区</p>
</li>
</ul>
<p>全局索引虽然为全局唯一、数据重新分区带来了可能，解决了一些业务需要根据不同维度进行查询的强需求，但是为此付出的代价是每一笔数据的写入都有可能变成<code>跨机的分布式事务</code>，在高并发的写入场景下它将影响系统的写入性能。当业务的查询可以拥有分区键的条件谓词时，OceanBase 数据库依旧推荐构建局部索引，通过数据库优化器的<code>分区裁剪功能</code>，排除掉不符合条件的分区。这样的做法可以同时兼顾查询和写入的性能，让系统的总体性能表现更优。</p>
<hr />
<h2 id="_3">唯一索引和非唯一索引<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>索引表分为唯一索引和非唯一索引，其中唯一索引保证在表内的索引列上不存在两行有完全相同的值，而非唯一索引则可能存在完全相同的值。在 OceanBase 数据库中，NULL 值也会存储在索引中。</p>
<p>​对于非唯一索引，索引表的存储键是用户指定的索引列和主表主键；而对于唯一索引列，索引表的存储键是用户指定的索引列和可变的主表主键列，这里可变的含义是主键列的值是随索引列值的不同而不同。</p>
<p>如下例所示，对于非唯一索引表 i1，它的存储键是 c2 和 c1，而对于唯一索引表 i2，它的存储键是 c2，而 c1 是可变的。当 c2 为 NULL 时，可变的 c1 列值是主表 c1 列的值；当 c2 不为 NULL 时，可变的 c1 列值为 NULL。</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t1</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">c3</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">c1</span><span class="p">));</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t1</span><span class="p">(</span><span class="n">c2</span><span class="p">);</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t1</span><span class="p">(</span><span class="n">c3</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<hr />
<h2 id="_4">索引的使用<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>当用户创建好索引后，OceanBase 数据库会自动维护该索引，所有的 DML 操作都会实时更新索引表相应的数据记录，同时优化器也会根据用户的查询来自动地选择是否使用索引。本文主要介绍如何进行索引扫描。</p>
<p>当 SQL 查询语句指定谓词条件查询的是索引列时，数据库会自动地抽取谓词条件作为查询索引的范围，也就是查询索引表的起始键和终止键。数据库根据起始键能定位到数据开始的位置，根据终止键能定位出数据结束位置，而开始和结束位置范围内所包含的数据是需要被此查询扫描的数据。</p>
<p>​对于索引表，OceanBase 数据库存储时使用 MemTable<code>内存</code> 和 SSTable<code>磁盘</code> 来存储数据，其中 MemTable 使用的是B+ 树结构，而 SSTable 使用的是宏块结构。在 MemTable 或者 SSTable 都按照上述扫描过程，扫描出相应的数据，而最终的数据行是由 MemTable 和 SSTable 的数据行融合成完整的数据行。</p>
<p>因此，<code>OB</code>查询索引表数据的完整过程如下：</p>
<ul>
<li>在 MemTable 中查询数据。</li>
<li>在 SSTable 中查询数据。</li>
<li>将 MemTable 和 SSTable 中的数据融合，得到完整的行。</li>
</ul>
<p>​当 SQL 查询语句只涉及到索引表中的列时，那么数据库会根据用户指定的列，按照上述查询过程，查询相应索引表的 MemTable 和 SSTable，得到完整的数据行。</p>
<p>​当 SQL 查询语句除了包含索引表中的列，还包含其他列时，数据库会先通过索引表，查询出相关的行，并根据行上的主键，按照上述查询过程，到主表中查询所需要的数据列<code>回表</code>。</p>
<hr />
<h2 id="_5">索引的存储<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p><code>OB</code>中，索引表的存储类似于普通的数据表，其数据也是存储在宏块和微块的结构中。由于 <code>OB</code>使用的是聚集索引表模型，因此在索引的行中除了用户指定的索引列之外，还会存储主表的主键列，以方便进行回表。</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../01%20%E5%A4%9A%E7%A7%9F%E6%88%B7/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 01 多租户" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              01 多租户
            </div>
          </div>
        </a>
      
      
        
        <a href="../03%20MySql%E5%88%86%E5%8C%BA/" class="md-footer__link md-footer__link--next" aria-label="Next: 03 MySql分区" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              03 MySql分区
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>